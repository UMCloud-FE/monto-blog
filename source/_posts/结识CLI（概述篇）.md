---
layout: post
title: 一、结识CLI（概述篇）
date: 2023-05-30 18:49:32
order: 0
tags: CLI
categories:
  - CLI
---

# 一、结识CLI（概述篇）

## 人机交互

人机交互（Human-Computer Interaction，HCI）的发展是伴随计算机的发展历程的。一个没有输入指令，只能输出的计算机是没有意义的，所以人们急需一个人机交互的媒介，或者叫工具来完成这种通信。

最早的计算机是通过打孔卡片、打孔纸带等输入数据，并通过打印机来输出结果；后来有了操作系统的概念，伴随着显示技术的发展，有了命令行界面（Command-Line interface，CLI）；后来随着技术的发展，有了图形交互界面（Graphics User Interface，GUI），后来又有了移动触摸式交互、自然用户界面（nature user interface，NUI）、智能用户界面（intelligent user interface，IUI）等。


那么，为什么在GUI占主流，更多的智能技术快速发展的今天，CLI 能够占有一席之地呢？

![维基百科上关于命令行界面的示意图](/images/cli/bash.png)

## 客户端开发

讲一下客户端开发都有哪几种形式（DOS环境、原生C、框架（Tarui、Election）、web技术（PWA））

- node 开发基本知识

## 我们为什么需要 CLI

尽管现代人机交互技术已经非常发达，但CLI依然有其重要的存在和优势：

- 效率：熟练的用户可以通过键入少量命令来完成复杂的操作，而无需通过图形界面进行多次点击和导航。
- 自动化：CLI非常适合自动化任务。通过脚本和命令序列，可以批量执行任务和操作，从而节省时间和精力，这个是图形界面不具备的。
- 标准化：CLI可以帮助团队成员统一创建项目、生成方案埋点、统一CSS、git操作、发布规范、代码规范等。
- 数据化：通过cli的日志监测等，可以做到研发数据的量化分析，进而不断迭代优化（如发布时间、代码构建速度等）。
- 远程管理：CLI可以通过SSH等协议远程管理服务器和网络设备，使得远程操作和管理变得便捷。
- 资源消耗：CLI通常占用较少的系统资源，特别是在资源有限的环境下（如服务器），CLI是非常实用的工具。
- 学习曲线：对于一些专业用户和开发人员来说，CLI可能更加直观和高效。有些任务在命令行下可以更快地完成，而且对于技术人员来说，CLI通常是日常工作中必备的工具。
- 批处理：在处理大量数据和文件时，CLI的批处理功能非常强大。它可以帮助用户更轻松地进行数据处理、文件重命名、搜索等操作。
- 可编程性：CLI通常可以通过自定义脚本来扩展其功能，使得用户可以根据自己的需求定制交互式体验。
- 发展性：CLI虽然历史老，但并不是止步不前的，互联网的接入、AI的协助，越来越多的插件系统的发展，使得CLI换发了第二春。

下面是一个互联网大厂的技术团队组织结构示意图：

![部门技术结构图](/images/cli/organization.png)

可以看到，CLI 贯穿整个团队基础架构的生命周期。就拿作者所在公司为例，前端项目通过微服务启动器创建，需要 CLI 作为启动媒介，并自动获取 webpack、eslint 配置以及公用依赖组件，这种规范化对于大型团队协作是必须的；同时，在项目开发过程中，也需要借助 CLI 生成云组件、特殊样式；在打包发布时，可以通过 CLI + CI/CD 来自动注册企业灰度系统，并发布在指定环境中。

按照我们上面的讲述，可以给CLI一个定位：`CLI是给相对专业的人士，进行高效的团队合作的有力工具`。展开来说可以是如下几点：

- 是绝大多数程序员的必备技能
- 是基础架构团队必备的工具
- 可以跨越的业务很广（管理后台 - 业务组件与平台 - 客户产品前后端开发与构建 - 统计服务 - 自动化）
- 可以跨越的技术场景很广（开发 - 构建 - 测试 - 发布）

> 与 devOps 工具的区别：devOps工具，类似 Jenkins，gitLab CI/CD等，通常在git hook中出发，在服务端进行，无法覆盖研发人员本地的开发/调试功能。而且定制复杂，对语言有一定的要求，需要专业的运维人员来操作。

## 怎么使用CLI

CLI 本质是一个操作系统的客户端，他提供命令行用户界面，允许用户通过键盘输入命令来与计算机进行交互。使用格式一般为：

```shell
CLI名称 [指令名] [参数名] [参数值]
```

其使用规范可总结如下：

- 主名称开头
- 通过指令名引导不同的功能
- 使用双横线的参数作为指令补充，比如 --force（或单横线缩写，比如 -f）
- 指令名和参数理论上为可选项，也可通过自定义解析设置为必选
- 使用 Ctrl + C 可终止阻塞的程序

对使用者来说，CLI就是命令行交互工具，通过接收用户输入命令和参数来执行对应的操作。

Windows系统：点击"开始"按钮，搜索并打开"命令提示符"或"PowerShell"。
macOS系统：打开"应用程序"文件夹，进入"实用工具"并打开"终端"。

一个简单的例子，平时打开删除文件`index.html`，需要以下步骤：

- 1、找到文件
- 2、点击右键，选择删除
- 3、点击确定

通过计算机的CLI我们可以直接 `rm -rf ./index.html`，文件就被删除了。

作为一个前端工程师，我们介绍的CLI，是通过调用 `node` 的能力，来实现各种计算机操作，例如：

- npm
- create-react-app 
- vue-cli 
- webpack-cli
- prettier-cli
- vite

我们本地安装一下 `yarn`，用这个成熟的 CLI 为例来解释一下它的运行机理：

```shell
npm install --global yarn
```

此时我们可以看到版本号：

```shell
yarn --version
```

![yarn-version](/images/cli/yarn-version-cmd.png)

上面便是一个 CLI 命令及其返回结果。我们全局安装了 `yarn`，node 才能够识别这个指令的，我们看一下全局安装的位置：

```shell
npm list -g
```

![npm全局安装目录](/images/cli/npm-list.png)

我们追进这个目录下，看到原来是给安装到系统默认的全局的 `node_modules` 下了：

![npm全局安装目录2](/images/cli/npm-g-node_modules.png)

我们也可以通过如下指令查看安装位置，效果一样：

```shell
which yarn
```

大家可能也知道，仅仅这样是不行的，终端是不会解析全局指令 `yarn` 的，因为他不知道这个目录。系统是通过全局变量来找路径的，我们看一下：

```shell
# 打印环境变量 PATH
echo $PATH # windows使用 %PATH%
```

可以看到貌似刚刚的目录有在这里，但似乎是上级目录：

![全局变量bin目录](/images/cli/path-list.png)

我们进去这个 bin 目录看到，这里有 yarn，而且是个软连接：

![全局变量团联建](/images/cli/yarn-soft-link.png)

至此，思路就打通了，原来全局安装指令这，是先要下载远程包放在全局的 lib 下，然后配置全局 PATH ，并引入 lib 的软连接。

那么我们自己的包如果是本地开发要怎么做软连接配置呢？如果有多个依赖包，他们会分别被软连接吗？`--version` 能够打印版本号又是怎么一回事？学完本系列课程，相信您会有更多的思考。

## CLI可以实现什么功能

有了上面的讲述，相信你对 CLI 的基本使用已经有所了解，你也应该能猜出来他能干什么了吧？

我们可以这样使用，例如：

- 打开一个浏览器地址

```js
import { exec } from 'child_process';

const browserCommand = process.platform === 'darwin' ? 'open' : process.platform === 'win32' ? 'start' : 'xdg-open';

exec(`${openCommand} ${url}`);
```

- 比如管理你的项目，通过模版直接拉取，方便团队共同使用 

```js
import { execa } from 'execa'
execa(`git`, ['clone', '-b', 分支名, 远程仓库名])`
```

- 又比如初始化项目：

```shell
npm create vite@latest my-vue-app -- --template vue
```

其他的功能数不胜数：

- 启动一个本地服务器
- 对代码进行扫描分析
- 提供前端的各种构建能力（webpack-cli等）
- 对代码进行格式化
- 管理微服务
- 配置自动化工作流
- ...

## 总结

本节课带大家了解了人机交互的发展，并阐述了 CLI 的发展地位与应用场景，并带大家初步了解了一个 CLI 执行的过程。

## 本课程的目的

本课程从一个使用案例出发，带大家从零开始完成一个自己的基于 `nodejs` 的 CLI 工具。学完本系列课程，您可以学会：

- CLI 运行原理
- CLI 的开发与使用
- CLI 常用工具使用
- CLI 项目的发布与管理

## 章节目录

下面是本系列课程的目录，供大家阅览：

- 结识CLI（概述篇）
- 结识CLI（应用篇）<初始化，原生使用>
- CLI 常用的工具库介绍
- 结识CLI（原理篇）
- 使用CLI实现前端接口Mock功能（实践篇）
- 使用CLI实现前端云组件模板管理功能（实践篇）
- 使用CLI实现前端项目自动化部署（实践篇）
- 撰写CLI的单元测试 \<vitest>
- 将我们的 CLI 发布 NPM 仓库与版本控制 <需讲述依赖在本地和远程两种情况>
- 实现CLI本地日志功能
- 扩展：给我们的CLI一个更好的展示 \<welcome页、用户文档等>
- 扩展：给体量过大的 CLI 项目添加包管理工具 \<lerna>
